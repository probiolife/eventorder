<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ç›Šç”Ÿæ´»è¨‚è³¼è¡¨å–®</title>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
</head>
<body class="bg-gray-100 p-6">
    <h1 style="font-size: 2rem;font-weight: bold;text-align: center;margin-top: 20px;margin-bottom: 30px;
    font-family: 'Noto Sans TC', sans-serif;color: #092e7dce;
  ">
    ç›Šç”Ÿæ´»è¨‚è³¼è¡¨æ ¼--ä¸­å¤§äººå¿«é–ƒå„ªæƒ  5æœˆ6æ—¥-8æ—¥
  </h1>
  
 <!-- åŸºæœ¬è¡¨å–®å€æ®µ -->
 <div class="form-section">
    <label>å–è²¨æ–¹å¼ï¼š</label><br>
    <label><input type="radio" name="pickup" value="ä¸­å¤§è‡ªå–" checked> ä¸­å¤§è‡ªå–</label>
    <label><input type="radio" name="pickup" value="é€è²¨"> é€è²¨ï¼ˆ$500 ä»¥ä¸‹åŠ  $50 é‹è²»ï¼‰</label>
  </div>
  <div class="form-section">
    <label>ä»˜æ¬¾æ–¹å¼ï¼š</label><br>
    <label><input type="radio" name="payment" value="FPS" checked> FPS / éŠ€è¡Œéæ•¸åˆ° Hang Seng Bank 228-764981-883 HSK GeneTech Limited </label>
  </div>
  <div class="mb-4"><label class="block mb-1">å§“å <span class="text-red-500">*</span></label><input type="text" id="name" class="w-full border rounded p-2" required></div>
  <div class="mb-4"><label class="block mb-1">é›»è©± (å¯ä»¥whatsappè¯çµ¡) <span class="text-red-500">*</span></label><input type="text" id="phone" class="w-full border rounded p-2" required></div>
  <div class="mb-4"><label class="block mb-1">é›»éƒµ</label><input type="email" id="email" class="w-full border rounded p-2"></div>
  <div class="mb-4"><label class="block mb-1">é€è²¨åœ°å€ï¼ˆå¦‚é¸æ“‡é€è²¨ï¼‰ï¼š</label><input type="text" id="address" class="w-full border rounded pt-4"></div>
  <div class="mb-4"><label class="block mb-1">ä»»é¸/å£å‘³å‚™è¨»ï¼š</label><input type="text" id="remark" class="w-full border rounded pt-4"></div>
</div>

  <div class="flex flex-wrap gap-2 mb-6" id="tabs">
    <button class="tab-btn p-2 border rounded" data-category="å…¨éƒ¨">å…¨éƒ¨</button>
    <button class="tab-btn p-2 border rounded" data-category="Probiolife">Probiolife</button>
    <button class="tab-btn p-2 border rounded" data-category="Immune">å¼·å…ç–«æ‹æª”</button>
    <button class="tab-btn p-2 border rounded" data-category="Biotrace">Biotrace</button>
    <button class="tab-btn p-2 border rounded" data-category="Oral">å£è…”å¥åº·</button>
    <button class="tab-btn p-2 border rounded" data-category="ProHealth">ProHealth</button>
    <button class="tab-btn p-2 border rounded" data-category="Professor">é—œæ•™æˆç²¾é¸</button>
  </div>

  <div id="products" class="space-y-4"></div>

  <div class="mt-6 border-t pt-4">
    <p>åŸåƒ¹ç¸½å’Œï¼š<span id="total-original">0</span> HKD</p>
    <p>æœƒå ´åƒ¹ç¸½å’Œï¼š<span id="total-sale">0</span> HKD</p>
    <p>æŠ˜æ‰£é‡‘é¡ï¼š<span id="total-discount">0</span> HKD</p>
    <p>é‹è²»ï¼š<span id="shipping">0</span> HKD</p>
    <p class="text-xl font-bold">è¨‚å–®ç¸½é‡‘é¡ï¼š<span id="grand-total">0</span> HKD</p>
  </div>

  <div id="gift-section" class="mt-6 hidden">
    <h2 class="text-lg font-bold mb-2 text-green-600">ğŸ è´ˆå“æ˜ç´°</h2>
    <ul id="gift-list" class="list-disc list-inside"></ul>
  </div>

  <!-- ç§»åˆ°åº•éƒ¨çš„æ“ä½œæŒ‰éˆ• -->
  <div class="mt-6 space-y-2">
    <button id="submit-btn" class="w-full bg-blue-600 text-white p-3 rounded">è¨‚å–®æ‘˜è¦</button>
    <button id="whatsapp-btn" class="w-full bg-green-500 text-white p-3 rounded">WhatsApp å‚³é€è¨‚å–®</button>
    <button id="reset-btn" class="w-full bg-gray-400 text-white p-3 rounded">é‡è¨­è¡¨å–®</button>
  </div>
</div>

<script>
const categories = {
  'Probiolife': [1,2,3,4,5,6,7,8,9,10,11],
  'Immune': [12,13,14,15,16,17,18],
  'Biotrace': [19,20,21,22,23,24,25,26,27,28,29,30],
  'Oral': [33,34,35,36,37,38],
  'ProHealth': [39,40,41,42,43,44],
  'Professor': [31,32,45,46,47,48,49,50]
};

const allProducts = [
  { id: 1, name: "ç›Šçº–èŒ é‡‘è£" },
  { id: 2, name: "ç›Šç·’å¯§ Lpc-37" },
  { id: 3, name: "ç›Šçº–è›‹ç™½ (å®¶ç”¨å¢é‡è£)" },
  { id: 4, name: "å¥è—»æ²¹ å¥§ç±³åŠ -3" },
  { id: 5, name: "ç›Šçº–èŒé‡‘è£/ç›Šç·’å¯§ä»»é¸ä¸‰ç›’" },
  { id: 6, name: "ç›Šçº–èŒé‡‘è£/ç›Šç·’å¯§ä»»é¸å…©ç›’" },
  { id: 7, name: "å¥è—»æ²¹ä¸€ç›’ï¼‹ç›Šçº–èŒé‡‘è£/ç›Šç·’å¯§ä¸€ç›’" },
  { id: 8, name: "2xç›Šçº–è›‹ç™½å®¶ç”¨å¢é‡è£" },
  { id: 9, name: "ç›Šçº–èŒé‡‘è£ (5åŒ…è©¦ç”¨è£)" },
  { id: 10, name: "ç›Šç”Ÿæ´»è›‹ç™½ç²‰æ–æ–æ¯" },
  { id: 11, name: "GUTSY LITEé«”é©—è¨ˆåŠƒ" },
  { id: 12, name: "Lactovitalä¹³éµè›‹ç™½1æ¨½" },
  { id: 13, name: "Lactovitalä¹³éµè›‹ç™½2æ¨½" },
  { id: 14, name: "æŠµæŠ—åŠ›æ‹æª”å¥—è£" },
  { id: 15, name: "æ¶ˆåŒ–å…ç–«ç˜¦èº«çµ„åˆ" },
  { id: 16, name: "åŸºæœ¬å…ç–«ä¸‰åˆä¸€" },
  { id: 17, name: "è…¸é“å¥åº·å…ç–«å¥—è£" },
  { id: 18, name: "å®¶åº­å¼·æ•ˆå…ç–«å¥—è£" },
  { id: 19, name: "Biotrace ç¶œåˆD3+K2+é‚" },
  { id: 20, name: "Biotrace å¾®é‡å…ƒç´  ç¡’" },
  { id: 21, name: "Biotrace å¾®é‡å…ƒç´  é‚" },
  { id: 22, name: "Biotrace å¾®é‡å…ƒç´  é‹…" },
  { id: 23, name: "Biotrace è¤‡åˆå¾®é‡å…ƒç´ (æœ‰éŠ…)" },
  { id: 24, name: "Biotrace è¤‡åˆå¾®é‡å…ƒç´ (ç„¡éŠ…)" },
  { id: 25, name: "Biotrace å¾®é‡å…ƒç´  ç¡¼" },
  { id: 26, name: "Biotrace æª¸æª¬é…¸é‚" },
  { id: 27, name: "Biotrace æœ‰æ©Ÿé‹…" },
  { id: 28, name: "Biotrace ç”Ÿç‰©å¤§è’œç´ " },
  { id: 29, name: "Simply Potentè„‚è³ªé«”C 1200mg" },
  { id: 30, name: "Simply Potentè„‚è³ªé«”C 1500mg" },
  { id: 31, name: "å°é’æŸ‘æ™®æ´±èŒ¶" },
  { id: 32, name: "ç”Ÿå“‚å°é’æŸ‘æ™®æ´±èŒ¶" },
  { id: 33, name: "å¤©ç„¶ç”Ÿç‰©æº¶èŒé…¶ç‰™è† æˆäºº" },
  { id: 34, name: "å¤©ç„¶ç”Ÿç‰©æº¶èŒé…¶ç‰™è† æˆäººå­–è£" },
  { id: 35, name: "å¤©ç„¶ç”Ÿç‰©æº¶èŒé…¶ç‰™è† å…’ç«¥" },
  { id: 36, name: "å¤©ç„¶ç”Ÿç‰©æº¶èŒé…¶ç‰™è† å…’ç«¥å­–è£" },
  { id: 37, name: "å¤©ç„¶ç‰™è†æˆäººå…’ç«¥çµ„åˆ" },
  { id: 38, name: "Biotraceç›Šç”ŸèŒæ½”å£æ¶²" },
  { id: 39, name: "ProHealth NMN Pro500" },
  { id: 40, name: "ProHealthåå¼ç™½è—œè˜†é†‡" },
  { id: 41, name: "ProHealth NMN+ç™½è—œè˜†é†‡å¥—è£" },
  { id: 42, name: "ProHealth Vitamin D3" },
  { id: 43, name: "ProHealth Calcium AKG" },
  { id: 44, name: "ProHealth S-ä¹™é…°ç©€èƒ±ç”˜è‚½" },
  { id: 45, name: "That's it é®®æœæ£’è¿·ä½ " },
  { id: 46, name: "That's it ç„¡æ·»åŠ ç³–ç›Šç”ŸèŒæ°´æœæ£’" },
  { id: 47, name: "æ™ºèƒ½ç„¡ç·šè„ˆæè¡€æ°§å„€" },
  { id: 48, name: "Optipillow æ¸›å°‘é¼»é¼¾é¼»ç½©" },
  { id: 49, name: "ç›Šç”ŸåŠæ¹¯åŒ… å–®åŒ…" },
  { id: 50, name: "ç›Šç”ŸåŠæ¹¯åŒ… ä»»é¸ä¸‰åŒ…" }
];

const productPrices = {
  1: { original: 585, sale: 428 },
  2: { original: 685, sale: 428 },
  3: { original: 460, sale: 338 },
  4: { original: 285, sale: 188 },
  5: { original: 2343, sale: 1180 },
  6: { original: 1468, sale: 828 },
  7: { original: 998, sale: 588 },
  8: { original: 1008, sale: 580 },
  9: { original: 98, sale: 68 },
  10: { original: 88, sale: 58 },
  11: { original: 5980, sale: 4980 },
  12: { original: 680, sale: 368 },
  13: { original: 880, sale: 598 },
  14: { original: 888, sale: 598 },
  15: { original: 828, sale: 588 },
  16: { original: 1128, sale: 880 },
  17: { original: 1128, sale: 880 },
  18: { original: 1228, sale: 1080 },
  19: { original: 488, sale: 438 },
  20: { original: 268, sale: 238 },
  21: { original: 288, sale: 258 },
  22: { original: 268, sale: 238 },
  23: { original: 288, sale: 258 },
  24: { original: 288, sale: 258 },
  25: { original: 288, sale: 258 },
  26: { original: 388, sale: 348 },
  27: { original: 428, sale: 368 },
  28: { original: 388, sale: 338 },
  29: { original: 668, sale: 358 },
  30: { original: 768, sale: 388 },
  31: { original: 388, sale: 388 },
  32: { original: 480, sale: 480 },
  33: { original: 59, sale: 48 },
  34: { original: 89, sale: 78 },
  35: { original: 38, sale: 30 },
  36: { original: 59, sale: 48 },
  37: { original: 149, sale: 118 },
  38: { original: 468, sale: 268 },
  39: { original: 968, sale: 468 },
  40: { original: 568, sale: 328 },
  41: { original: 1568, sale: 698 },
  42: { original: 268, sale: 188 },
  43: { original: 388, sale: 280 },
  44: { original: 998, sale: 628 },
  45: { original: 13, sale: 10 },
  46: { original: 36, sale: 24 },
  47: { original: 1268, sale: 1268 },
  48: { original: 1638, sale: 1638 },
  49: { original: 48, sale: 42 },
  50: { original: 144, sale: 100 }
};


let productQuantities = {};
function hasMainProductSelected() {
  let hasMain = false;
  document.querySelectorAll('[data-product-id]').forEach(input => {
    const qty = parseInt(input.value);
    const id = parseInt(input.getAttribute('data-product-id'));
    if (qty > 0 && ((id >= 1 && id <= 8) || (id >= 12 && id <= 50))) {
      hasMain = true;
    }
  });
  return hasMain;
}



function renderProducts(category) {
  const productsDiv = document.getElementById('products');
  let hasMainProduct = false;
let specialCount = 0;

document.querySelectorAll('[data-product-id]').forEach(input => {
  const id = parseInt(input.getAttribute('data-product-id'));
  const qty = parseInt(input.value);
  if (qty > 0) {
    if ((id >= 1 && id <= 8) || (id >= 10 && id <= 48) || id === 50) {
      hasMainProduct = true;
    }
    if (id === 9 || id === 49) {
      specialCount += qty;
    }
  }
});

const allowSpecialPrice = hasMainProduct || specialCount >= 2;

  productsDiv.innerHTML = `
    <div class="grid grid-cols-5 gap-2 font-bold border-b pb-2">
      <div class="col-span-2">è²¨å“</div>
      <div class="text-right">åŸåƒ¹</div>
      <div class="text-right">å„ªæƒ åƒ¹</div>
      <div class="text-right">æ•¸é‡</div>
    </div>
  `;

  const filterIds = category === 'å…¨éƒ¨' ? allProducts.map(p => p.id) : categories[category];

  allProducts.filter(p => filterIds.includes(p.id)).forEach(product => {
    const quantity = productQuantities[product.id] || 0;
    const priceInfo = productPrices[product.id] || { original: 100, sale: 80 };
    let originalPrice = priceInfo.original;
    let salePrice = priceInfo.sale;

    if (product.id === 9) {
  salePrice = allowSpecialPrice ? 38 : 68;
}
if (product.id === 49) {
  salePrice = allowSpecialPrice ? 20 : 42;
}




    let optionNote = '';
    if (product.id === 5) optionNote = 'ï¼ˆç›Šçº–èŒé‡‘è£/ç›Šç·’å¯§ ä»»é¸ä¸‰ç›’ï¼‰';
    if (product.id === 6) optionNote = 'ï¼ˆç›Šçº–èŒé‡‘è£/ç›Šç·’å¯§ ä»»é¸å…©ç›’ï¼‰';
    if (product.id === 7) optionNote = 'ï¼ˆå¥è—»æ²¹1ç›’ï¼‹ç›Šçº–èŒé‡‘è£/ç›Šç·’å¯§ ä»»é¸1ç›’ï¼‰';
    if (product.id === 9) optionNote = 'ï¼ˆåŠ è³¼åƒ¹: $38ï¼‰';
    if (product.id === 14) optionNote = 'ï¼ˆé‡‘è£ç›Šçº–èŒï¼‹Lactovital ä¹³éµè›‹ç™½è† å›Š ï¼‰';
    if (product.id === 15) optionNote = 'ï¼ˆç›Šçº–è›‹ç™½å®¶ç”¨å¢é‡è£ï¼‹Lactovital ä¹³éµè›‹ç™½è† å›Š ï¼‰'; 
    if (product.id === 16) optionNote = 'ï¼ˆè„‚è³ªé«”ç¶­ä»–å‘½C (1200æ¯«å…‹)ï¼‹Biotrace ç´ é£Ÿç¶œåˆç¶­ä»–å‘½D3+K2+é‚ï¼‹Biotrace æœ‰æ©Ÿé‹… ï¼‰';
    if (product.id === 17) optionNote = 'ï¼ˆç›Šçº–èŒ é‡‘è£ï¼‹Lactovital ä¹³éµè›‹ç™½è† å›Šï¼‹Biotrace æœ‰æ©Ÿé‹… ï¼‰';
    if (product.id === 18) optionNote = 'ï¼ˆç›Šçº–èŒ é‡‘è£ï¼‹è„‚è³ªé«”ç¶­ä»–å‘½C (1200æ¯«å…‹)ï¼‹  Biotrace ç´ é£Ÿç¶œåˆç¶­ä»–å‘½D3+K2+é‚ ï¼‰';
    if (product.id === 45) optionNote = 'ï¼ˆèŠ’æœå‘³/è—è“å‘³/è‰è“å‘³/é¦™è•‰å‘³--è«‹è¨»æ˜ ï¼‰';
    if (product.id === 46) optionNote = 'ï¼ˆç„¡èŠ±æœå‘³/èŠ’æœå‘³/è—è“å‘³--è«‹è¨»æ˜ ï¼‰';
    if (product.id === 49) optionNote = 'ï¼ˆæ¹¯åŒ… ä»»é¸ä¸€åŒ… åŠ è³¼åƒ¹: $20ï¼‰';
    if (product.id === 50) optionNote = 'ï¼ˆæ¹¯åŒ… ä»»é¸ä¸‰åŒ…ï¼‰';

    const wrapper = document.createElement('div');
    wrapper.className = 'grid grid-cols-5 gap-2 items-center border-b py-2';

    wrapper.innerHTML = `
      <div class="col-span-2">
        ${product.name}
        ${optionNote ? `<div class="text-xs text-gray-500">${optionNote}</div>` : ''}
      </div>
      <div class="text-right">${originalPrice} HKD</div>
      <div class="text-right text-red-600">${salePrice} HKD</div>
      <div class="text-right">
        <input type="number" min="0" value="${quantity}" data-product-id="${product.id}" class="border rounded p-2 w-20 text-right">
      </div>
    `;

    productsDiv.appendChild(wrapper);
  });

  setupProductListeners();
}


function setupProductListeners() {
  document.querySelectorAll('[data-product-id]').forEach(input => {
    input.addEventListener('input', (e) => {
      const id = parseInt(e.target.getAttribute('data-product-id'));
      const qty = parseInt(e.target.value) || 0;
      const wasMain = hasMainProductSelected();

      if (qty > 0) {
        productQuantities[id] = qty;
      } else {
        delete productQuantities[id];
      }

      const isMain = hasMainProductSelected();
      updateOrderSummary();

      // ğŸ” è‹¥ä¸»å•†å“ç‹€æ…‹æ”¹è®Šï¼Œéœ€å¼·åˆ¶æ›´æ–°åƒ¹æ ¼é¡¯ç¤º
      if (wasMain !== isMain) {
        updateProductPrices(); // å°ˆé–€åªæ›´æ–°åƒ¹æ ¼å€
      } else {
        // åƒ…æ›´æ–°è©²ç­†è¼¸å…¥å½±éŸ¿çš„å•†å“å°è¨ˆï¼ˆå¯é¸æ“‡åŠ ä¸Šï¼‰
      }
    });
  });
}





function updateOrderSummary() {
  let totalOriginal = 0;
  let totalSale = 0;

  const quantities = {};
  let hasMainProduct = false;
  let specialCount = 0;

  for (const idStr in productQuantities) {
  const id = parseInt(idStr);
  const qty = productQuantities[id];
  if (qty > 0) {
    quantities[id] = qty;

    if ((id >= 1 && id <= 8) || (id >= 10 && id <= 48) || id === 50) {
      hasMainProduct = true;
    }

    if (id === 9 || id === 49) {
      specialCount += qty;
    }
  }
}


  const allowSpecialPrice = hasMainProduct || specialCount >= 2;

  for (const idStr in quantities) {
    const id = parseInt(idStr);
    const qty = quantities[id];
    const priceInfo = productPrices[id] || { original: 100, sale: 80 };
    let originalPrice = priceInfo.original;
    let salePrice = priceInfo.sale;

    if (id === 9) salePrice = allowSpecialPrice ? 38 : 68;
    if (id === 49) salePrice = allowSpecialPrice ? 20 : 42;

    totalOriginal += originalPrice * qty;
    totalSale += salePrice * qty;
  }

  const discount = totalOriginal - totalSale;
  const hasProducts = Object.values(quantities).some(qty => qty > 0);
  const pickup = document.querySelector('input[name="pickup"]:checked')?.value || '';
  const shipping = (pickup === 'é€è²¨' && hasProducts && totalSale < 500) ? 50 : 0;
  const grandTotal = totalSale + shipping;

  document.getElementById('total-original').innerText = totalOriginal;
  document.getElementById('total-sale').innerText = totalSale;
  document.getElementById('total-discount').innerText = discount;
  document.getElementById('shipping').innerText = shipping;
  document.getElementById('grand-total').innerText = grandTotal;

  updateGiftList();
}


function updateProductPrices() {
  document.querySelectorAll('[data-product-id]').forEach(input => {
    const id = parseInt(input.getAttribute('data-product-id'));
    const qty = productQuantities[id] || 0;
    const pid = parseInt(id);
    const priceInfo = productPrices[pid] || { original: 100, sale: 80 };
    const originalPrice = priceInfo.original;

    let salePrice = priceInfo.sale;
    if (pid === 9) salePrice = hasMainProductSelected() ? 38 : 68;
    if (pid === 49) salePrice = hasMainProductSelected() ? 20 : 42;

    // æ›´æ–°å°æ‡‰ç”¢å“çš„é¡¯ç¤ºåƒ¹æ ¼
    const wrapper = input.closest('.grid');
    if (wrapper) {
      wrapper.querySelector('.text-red-600').innerText = `${salePrice} HKD`;
    }
  });
}

function updateGiftList() {
  const giftSection = document.getElementById('gift-section');
  const giftList = document.getElementById('gift-list');
  giftList.innerHTML = '';

  let gifts = [];

  if (productQuantities[5]) {
    for (let i = 0; i < productQuantities[5]; i++) {
      gifts.push('1x ç›Šç”ŸèŒ å±±æ ¸æ¡ƒ é»‘æœ±å¤åŠ› (é‡‘è£)');
    }
  }
  if (productQuantities[6]) {
    for (let i = 0; i < productQuantities[6]; i++) {
      gifts.push('1x ç›Šçº–èŒ é‡‘è£ (5åŒ…è©¦ç”¨è£)');
    }
  }
  if (productQuantities[7]) {
    for (let i = 0; i < productQuantities[7]; i++) {
      gifts.push('1x That\'s it 100%ç´”æ°´æœæ£’ï¼ˆæ¢¨å‘³ï¼‰');
    }
  }
  if (productQuantities[8]) {
    for (let i = 0; i < productQuantities[8]; i++) {
      gifts.push('1x ç›Šç”Ÿæ´» è›‹ç™½ç²‰æ–æ–æ¯');
    }
  }
  if (productQuantities[38]) {
    for (let i = 0; i < productQuantities[38]; i++) {
      gifts.push('1x ç”Ÿç‰©æº¶èŒé…¶ç‰™è† (æ—…è¡Œè£)');
    }
  }

  gifts.forEach(gift => {
    const li = document.createElement('li');
    li.innerText = gift;
    giftList.appendChild(li);
  });

  if (gifts.length > 0) {
    giftSection.classList.remove('hidden');
  } else {
    giftSection.classList.add('hidden');
  }
}

document.addEventListener('DOMContentLoaded', () => {
  renderProducts('å…¨éƒ¨');
  updateOrderSummary();

  const tabButtons = document.querySelectorAll('.tab-btn');
  tabButtons.forEach(btn => {
    btn.addEventListener('click', () => {
  tabButtons.forEach(b => b.classList.remove('bg-blue-500', 'text-white'));
  btn.classList.add('bg-blue-500', 'text-white');
  const category = btn.getAttribute('data-category');
  renderProducts(category);
  updateOrderSummary(); // ğŸŸ¢ åŠ é€™ä¸€è¡Œï¼šä¿è­‰åˆ‡æ›åˆ†é¡æ™‚ç¸½é‡‘é¡æ­£ç¢ºé‡ç®—
});
    // ç›£è½å–è²¨æ–¹å¼åˆ‡æ› â†’ ç«‹å³æ›´æ–°é‡‘é¡é¡¯ç¤º
  document.querySelectorAll('input[name="pickup"]').forEach(radio => {
  radio.addEventListener('change', updateOrderSummary);
});
});
  });





// æ–°å¢æäº¤æŒ‰éˆ•äº‹ä»¶
document.getElementById('submit-btn').addEventListener('click', () => handleOrder(false));
document.getElementById('whatsapp-btn').addEventListener('click', () => handleOrder(true));
document.getElementById('reset-btn').addEventListener('click', () => {
  if (confirm('ç¢ºå®šè¦é‡è¨­æ‰€æœ‰è³‡æ–™ï¼Ÿ')) {
    ['name','phone','email','address','remark'].forEach(id => document.getElementById(id).value = '');
  }
});

function handleOrder(isWhatsApp) {
  const name = document.getElementById('name').value.trim();
  const phone = document.getElementById('phone').value.trim();
  const email = document.getElementById('email').value.trim();
  const address = document.getElementById('address')?.value.trim() || '';
  const remark = document.getElementById('remark')?.value.trim() || '';
  const pickup = document.querySelector('input[name="pickup"]:checked')?.value || '';
  const payment = document.querySelector('input[name="payment"]:checked')?.value || '';
  const total = document.getElementById('grand-total').innerText;

  if (!name || !phone) {
    alert('è«‹å¡«å¯«å§“åå’Œé›»è©±ï¼');
    return;
  }

const quantities = {};
let hasMainProduct = false;
let specialCount = 0;

document.querySelectorAll('[data-product-id]').forEach(input => {
  const id = parseInt(input.getAttribute('data-product-id'));
  const qty = parseInt(input.value);
  if (qty > 0) {
    quantities[id] = qty;

    if ((id >= 1 && id <= 8) || (id >= 10 && id <= 48) || id === 50) {
      hasMainProduct = true;
    }

    if (id === 9 || id === 49) {
      specialCount += qty;
    }
  }
});

const allowSpecialPrice = hasMainProduct || specialCount >= 2;


  // âœ… ç¬¬äºŒï¼šå†æ ¹æ“šåˆ¤æ–·çµæœç”¢ç”Ÿæ­£ç¢ºåƒ¹æ ¼
  let orderDetails = '';
  document.querySelectorAll('[data-product-id]').forEach(input => {
    const qty = parseInt(input.value);
    if (qty > 0) {
      const id = parseInt(input.getAttribute('data-product-id'));
      const label = input.closest('div.grid').querySelector('div.col-span-2').innerText.trim().replace(/\s+/g, ' ');
      const priceInfo = productPrices[id] || { original: 100, sale: 80 };
      let unitPrice = priceInfo.sale;

      if (id === 9) unitPrice = allowSpecialPrice ? 38 : 68;
      if (id === 49) unitPrice = allowSpecialPrice ? 20 : 42;



      const subtotal = qty * unitPrice;
      orderDetails += `â€¢ ${label} x ${qty}ç›’ï¼ˆ${unitPrice} HKD/ç›’ï¼Œå…± ${subtotal} HKDï¼‰\n`;
    }
  });

  let giftDetails = '';
  document.querySelectorAll('#gift-list li').forEach(li => {
    giftDetails += `ğŸ ${li.innerText}\n`;
  });

  const summary = `
ã€æ”¶åˆ°è¨‚å–®å¾Œ,æˆ‘å€‘æœƒæœ‰å°ˆäººä»¥WhatsAppè¯çµ¡æ‚¨æœ‰é—œä»˜æ¬¾åŠæ”¶è²¨äº‹å®œã€‘
ã€è¨‚å–®æ‘˜è¦ã€‘
å§“åï¼š${name}
é›»è©±ï¼š${phone}
é›»éƒµï¼š${email}
å–è²¨æ–¹å¼ï¼š${pickup}
ä»˜æ¬¾æ–¹å¼ï¼š${payment}
é€è²¨åœ°å€ï¼š${address}
å‚™è¨»ï¼š${remark}

ã€è³¼è²·å•†å“ã€‘
${orderDetails || 'ï¼ˆç„¡ï¼‰'}

ã€è´ˆå“ã€‘
${giftDetails || 'ï¼ˆç„¡ï¼‰'}

è¨‚å–®ç¸½é‡‘é¡ï¼š${total} HKD
`;

  if (isWhatsApp) {
    const whatsappNumber = '85257023008';
    const encodedMsg = encodeURIComponent(summary);
    window.open(`https://wa.me/${whatsappNumber}?text=${encodedMsg}`, '_blank');
  } else {
    generatePDF({ name, summary });
  }
}


function generatePDF({ name, summary }) {
  // ç§»é™¤èˆŠçš„æ¡†æ¡†ï¼ˆå¦‚æœæœ‰ï¼‰
  const existing = document.getElementById('order-summary-popup');
  if (existing) existing.remove();

  const container = document.createElement('div');
  container.id = 'order-summary-popup';
  container.style.position = 'fixed';
  container.style.top = '50%';
  container.style.left = '50%';
  container.style.transform = 'translate(-50%, -50%)';
  container.style.background = 'white';
  container.style.border = '1px solid #ccc';
  container.style.padding = '20px';
  container.style.boxShadow = '0 2px 10px rgba(0,0,0,0.2)';
  container.style.zIndex = '9999';
  container.style.maxWidth = '90%';
  container.style.maxHeight = '80%';
  container.style.overflowY = 'auto';

  const title = document.createElement('h2');
  title.textContent = 'ğŸ“¦ è¨‚å–®æ‘˜è¦';
  title.style.fontSize = '1.25rem';
  title.style.marginBottom = '10px';

  const textarea = document.createElement('textarea');
  textarea.value = summary;
  textarea.style.width = '100%';
  textarea.style.height = '300px';
  textarea.style.fontFamily = 'Noto Sans TC, sans-serif';
  textarea.style.fontSize = '14px';
  textarea.style.padding = '10px';

  const copyBtn = document.createElement('button');
  copyBtn.textContent = 'è¤‡è£½å…§å®¹';
  copyBtn.style.marginTop = '10px';
  copyBtn.style.marginRight = '10px';
  copyBtn.style.background = '#10b981';
  copyBtn.style.color = 'white';
  copyBtn.style.padding = '8px 12px';
  copyBtn.style.border = 'none';
  copyBtn.style.borderRadius = '5px';
  copyBtn.addEventListener('click', () => {
    textarea.select();
    textarea.setSelectionRange(0, 99999);
    document.execCommand('copy');
    copyBtn.textContent = 'å·²è¤‡è£½!';
    setTimeout(() => copyBtn.textContent = 'è¤‡è£½å…§å®¹', 2000);
  });

  const closeBtn = document.createElement('button');
  closeBtn.textContent = 'é—œé–‰';
  closeBtn.style.marginTop = '10px';
  closeBtn.style.background = '#2563eb';
  closeBtn.style.color = 'white';
  closeBtn.style.padding = '8px 12px';
  closeBtn.style.border = 'none';
  closeBtn.style.borderRadius = '5px';
  closeBtn.addEventListener('click', () => container.remove());

  container.appendChild(title);
  container.appendChild(textarea);
  container.appendChild(copyBtn);
  container.appendChild(closeBtn);
  document.body.appendChild(container);

  textarea.select();
  textarea.setSelectionRange(0, 99999); // ç‚ºæ–¹ä¾¿è¤‡è£½
}

document.getElementById('reset-btn').addEventListener('click', () => {
  if (confirm('ç¢ºå®šè¦é‡è¨­æ‰€æœ‰è³‡æ–™ï¼Ÿ')) {
    ['name','phone','email','address','remark'].forEach(id => document.getElementById(id).value = '');
    productQuantities = {}; // æ¸…ç©ºå•†å“é¸æ“‡
    renderProducts('å…¨éƒ¨'); // é‡æ–°é¡¯ç¤ºç”¢å“æ¸…å–®
    updateOrderSummary(); // é‡è¨­é‡‘é¡
    const giftSection = document.getElementById('gift-section');
    if (giftSection) giftSection.classList.add('hidden');
  }
});

</script>

</body>
</html>
